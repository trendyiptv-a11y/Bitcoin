<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BTC – Coeziv</title>
  <style>
    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #0f172a 0, #020617 55%, #000 100%);
      color: #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .card {
      padding: 24px 20px;
      border-radius: 20px;
      border: 1px solid #1f2937;
      box-shadow: 0 24px 60px rgba(0,0,0,0.7);
      max-width: 380px;
      width: 100%;
      background: rgba(15,23,42,0.94);
      text-align: center;
    }
    .title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .subtitle {
      font-size: 12px;
      color: #9ca3af;
      margin-bottom: 16px;
    }
    .price {
      font-size: 32px;
      font-weight: 700;
      letter-spacing: 0.03em;
      margin-bottom: 4px;
    }
    .currency {
      font-size: 12px;
      color: #9ca3af;
      margin-bottom: 16px;
    }
    .message {
      font-size: 14px;
      margin-bottom: 10px;
    }
    .updated {
      font-size: 11px;
      color: #9ca3af;
    }
    .error {
      color: #f97373;
      font-size: 12px;
      margin-top: 8px;
    }
    .dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      display: inline-block;
      margin-right: 6px;
      background: #22c55e;
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="title">Bitcoin (BTC)</div>
    <div class="subtitle">
      Mecanism coeziv, actualizat aproximativ la fiecare oră.
    </div>

    <div id="price" class="price">–</div>
    <div class="currency">USD</div>

    <div id="message" class="message">
      Se încarcă mesajul coeziv...
    </div>

    <div class="updated" id="updated">
      <span class="dot"></span> Aștept ultimul snapshot coeziv.
    </div>
    <div class="error" id="error"></div>
  </div>

  <script>
    const PRICE_EL = document.getElementById("price");
    const MSG_EL = document.getElementById("message");
    const UPDATED_EL = document.getElementById("updated");
    const ERROR_EL = document.getElementById("error");

    async function loadState() {
      try {
        ERROR_EL.textContent = "";
        UPDATED_EL.textContent = "Încarc ultimul snapshot coeziv...";

        const res = await fetch("coeziv_state.json", { cache: "no-store" });
        if (!res.ok) {
          throw new Error("HTTP " + res.status);
        }
        const state = await res.json();

        const price = state.price_usd;
        const message = state.message;
        const ts = state.timestamp;
        const gen = state.generated_at;

        PRICE_EL.textContent = typeof price === "number"
          ? price.toLocaleString("en-US", {
              minimumFractionDigits: 0,
              maximumFractionDigits: 0
            })
          : "–";

        MSG_EL.textContent = message || "Nu există mesaj coeziv pentru acest moment.";

        UPDATED_EL.textContent = `Snapshot la ${ts || "n/a"} · generat la ${gen || "n/a"}`;
      } catch (err) {
        console.error(err);
        ERROR_EL.textContent = "Nu am putut încărca coeziv_state.json. Verifică dacă workflow-ul de backend rulează.";
      }
    }

    loadState();
    // dacă vrei și refresh din browser: de ex. la 5 minute
    setInterval(loadState, 5 * 60 * 1000);
  </script>
</body>
</html>
