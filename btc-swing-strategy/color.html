<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mecanism Coeziv BTC</title>

<style>
:root {
  --bg-main: #020617;
  --bg-card: rgba(15, 23, 42, 0.96);
  --border-card: #1f2937;
  --text-main: #e5e7eb;
  --text-muted: #9ca3af;
  --text-soft: #6b7280;
  --accent-bull: #22c55e;
  --accent-bear: #f97373;
  --accent-neutral: #64748b;
  --accent-live: #38bdf8;
  --accent-bg-chip: rgba(15, 23, 42, 0.9);
}

* { box-sizing: border-box; }

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background: #020617;
  color: var(--text-main);
  display: flex;
  justify-content: center;
  padding: 16px;
}

.shell { width: 100%; max-width: 520px; }

.card {
  background: var(--bg-card);
  border-radius: 24px;
  border: 1px solid var(--border-card);
  padding: 20px;
  margin-bottom: 14px;
}

.card-secondary {
  background: rgba(15,23,42,0.92);
}

.history-header {
  margin-bottom: 10px;
}

.history-title {
  font-size: 13px;
  font-weight: 600;
  letter-spacing: 0.05em;
  text-transform: uppercase;
  color: var(--text-muted);
}

.history-subtitle {
  font-size: 11px;
  color: var(--text-soft);
}

/* rândurile de regim */
.history-row {
  padding: 8px 10px;
  border-radius: 10px;
  background: rgba(15,23,42,0.9);
  border: 1px solid rgba(31,41,55,0.9);
  font-size: 11px;
  margin-bottom: 6px;
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.history-date {
  font-weight: 600;
}

.history-tag {
  font-size: 10px;
  color: var(--text-soft);
}

/* ===== HIGHLIGHT REGIM ===== */
.history-row.active-regime {
  border-color: var(--accent-live) !important;
  background: rgba(56, 189, 248, 0.12) !important;
}

.history-row.active-regime .history-date {
  color: var(--accent-live);
}
</style>
</head>

<body>
<div class="shell">

  <div class="card card-secondary">
    <div class="history-header">
      <div class="history-title">REGIMURI STANDARD DE PIAȚĂ</div>
      <div class="history-subtitle">
        Regimul curent este evidențiat automat în listă.
      </div>
    </div>

    <div class="history-row" data-regime="trend_up_strong">
      <div class="history-date">1. Trend ascendent susținut</div>
      <div class="history-tag">Cumpărătorii domină clar piața, maxime și minime în creștere.</div>
    </div>

    <div class="history-row" data-regime="trend_up_moderate">
      <div class="history-date">2. Trend ascendent moderat</div>
      <div class="history-tag">Creștere cu corecții regulate, dar structura rămâne bullish.</div>
    </div>

    <div class="history-row" data-regime="range_bias_up">
      <div class="history-date">3. Range cu bias pozitiv</div>
      <div class="history-tag">Consolidare, dar maximele tind să fie împinse mai sus.</div>
    </div>

    <div class="history-row" data-regime="range_neutral">
      <div class="history-date">4. Range neutru</div>
      <div class="history-tag">Echilibru relativ între cumpărători și vânzători.</div>
    </div>

    <div class="history-row" data-regime="range_bias_down">
      <div class="history-date">5. Range cu bias negativ</div>
      <div class="history-tag">Consolidare cu presiune de vânzare ușor dominantă.</div>
    </div>

    <div class="history-row" data-regime="trend_down_moderate">
      <div class="history-date">6. Trend descendent moderat</div>
      <div class="history-tag">Scădere cu reacții de cumpărare, dar lower highs / lower lows.</div>
    </div>

    <div class="history-row" data-regime="trend_down_strong">
      <div class="history-date">7. Trend descendent susținut</div>
      <div class="history-tag">Vânzătorii controlează structura, scăderi agresive.</div>
    </div>

    <div class="history-row" data-regime="neutral_transition">
      <div class="history-date">8. Regim neutru / tranziție</div>
      <div class="history-tag">Zonă de schimbare de regim, structură indecisă.</div>
    </div>
  </div>

</div>

<script>
// highlight regim curent din backend / mecanism

// Codurile de regim valide - trebuie să corespundă atributelor data-regime din HTML
const VALID_REGIMES = new Set([
  "trend_up_strong",
  "trend_up_moderate",
  "range_bias_up",
  "range_neutral",
  "range_bias_down",
  "trend_down_moderate",
  "trend_down_strong",
  "neutral_transition"
]);

// Funcția internă care face efectiv highlight pe rândul potrivit
function highlightMarketRegime(regime) {
  if (!regime) return;

  // Acceptă fie string direct ("range_bias_up"), fie obiect cu proprietatea .code
  const code = typeof regime === "string" ? regime : regime.code;

  if (!VALID_REGIMES.has(code)) {
    console.warn("[REGIM] Cod de regim invalid:", code);
    return;
  }

  // Ștergem highlight-ul anterior
  document
    .querySelectorAll(".history-row[data-regime]")
    .forEach(el => el.classList.remove("active-regime"));

  // Aplicăm highlight pe rândul care corespunde codului
  const el = document.querySelector(`.history-row[data-regime="${code}"]`);
  if (el) el.classList.add("active-regime");
}

// API simplu pentru mecanism:
// Din mecanism, când ai codul regimului, apelezi:
//   window.setMarketRegime("range_bias_up")
// sau
//   window.setMarketRegime({ code: "range_bias_up" })
function setMarketRegime(regime) {
  highlightMarketRegime(regime);
}
window.setMarketRegime = setMarketRegime;

// Dacă există un obiect global `state` cu `market_regime`, îl folosim automat la încărcare
try {
  if (typeof state !== "undefined" && state && state.market_regime) {
    highlightMarketRegime(state.market_regime);
  }
} catch (e) {
  // ignorăm eroarea dacă `state` nu există
}

// DEMO – pentru test local. Comentează linia asta în producție.
// highlightMarketRegime("range_bias_up");
</script>

</body>
</html>
